---
title: "HS614 HW#3"
author: "Tiffany Chua"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Working Directory}
getwd()
```

# HS614: Homework #3
For this HW use the diabetes dataset.

Exploratory Data Analysis:
1. Explore the data
2. How many rows and columns?
3. Any NAs? If yes, which columns?
4. Any strange values? If yes, what to do?
5. Any correlation between features?
6. Statistics of the columns and some exploratory plots (bar plot, histogram, boxplot ...)

Build at least 4 different predictive models that can predict (classify) Diabetic patients. Compare the performance of the models.

Column definitions of this dataset are given in table 1 of this paper: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8306487/

***

```{r Libraries}
library(Amelia)
library(ggplot2)
library(GGally)
library(caTools)
library(caret)
library(class)
library(e1071)
library(psych)
library(corrplot)
library(ISLR)
library(cluster)
library(datasets)
library(pastecs)
library(psych)
library(corrplot)
library(stats)
library(Hmisc)
library(mice)
library(VIM)
library(dplyr)
library(hrbrthemes)
library(tidyverse)
library(factoextra)
library(pROC)
library(rpart)
library(rpart.plot)
library(randomForest)
library(animation)
```

```{r Read in Dataset}
diab <- read.csv("./diabetes.csv")
head(diab)
str(diab)
```

## Variable Definitions
1. Pregnancy - Frequency of pregnancy
2. Glucose - Concentration of plasma glucose (mg/dL)
3. BP - Diastolic blood pressure (mmHg)
4. Skin - Tricep skinfold thickness (mm)
5. Insulin - Two-hour serum insulin (mu U/ml)
6. BMI - Body mass index (kg/m2)
7. Pedigree - A pedigree function for diabetes
8. Age - Age (log(years))

```{r Outcome Factor}
diab$Outcome = factor(diab$Outcome)
str(diab)

table(diab$Outcome)
```

## Rows & Columns
```{r}
nrow(diab)
ncol(diab)
```

## Missing & Strange Variables
```{r Missing/NA}
sum(is.na(diab))
missmap(diab)

#Note: While there are no NA variables, missing data points seem to have been replaced with a value of 0 in columns
```
Note: While there are no NA variables, missing data points seem to have been replaced with a value of 0 in columns.

```{r Rows with Value 0 per Column}
sum(diab$Glucose == 0)
sum(diab$BloodPressure == 0)
sum(diab$SkinThickness == 0)
sum(diab$Insulin == 0)
sum(diab$BMI == 0)
sum(diab$DiabetesPedigreeFunction == 0)
sum(diab$Age == 0)

#Strange Values:
#The following columns returned values of 0 Glucose, BloodPressure, SkinThickness, Insulin, and BMI; It is likely that missing/NA variables for these columns were replaced with 0, as 0 is a highly unlikely and unrealistic observation for these features
```

**Strange Values**
The following columns returned values of 0: Glucose, BloodPressure, SkinThickness, Insulin, and BMI. It is likely that missing/NA variables for these columns were replaced with 0, as 0 is a highly unlikely and unrealistic observation for these features.

```{r Change Strange Values to NA}
#What to do with the strange values?
diab1 <- diab

#Turn strange (0) values into NA
diab1$Glucose[diab1$Glucose == 0] = NA
diab1$BloodPressure[diab1$BloodPressure == 0] = NA
diab1$SkinThickness[diab1$SkinThickness == 0] = NA
diab1$Insulin[diab1$Insulin == 0] = NA
diab1$BMI[diab1$BMI == 0] = NA

sum(is.na(diab1))
missmap(diab1)

#I will use mean imputation on the NA variables in the Predictive Models section (after Train/Test Split)
```
What to do with the strange variables?
1. Turn strange (0) values into NA.
2. I will use mean imputation on the NA variables in the Predicive Models section (after Train/Test Split).

*** 

# Exploratory Data Analysis

## Initial Read
### Descriptive Statistics
```{r Descriptive Statistics}
stat.desc(diab1)
summary(diab1)
```

### Correlations
```{r Correlations}
diab_num <- diab1[1:8]

M <- cor(diab_num,
         method = "pearson")
M
corrplot(M,
         method = "square")
cor.plot(diab_num)

#Highest Correlating Variables:
# BMI & SkinThickness = 0.65
# Insulin & Glucose = 0.58
# Pregnancies & Age = 0.54
# BloodPressure & Age = 0.33
# BMI & BloodPressure = 0.29
```
Highest Correlating Variables:
* BMI & SkinThickness = 0.65
* Insulin & Glucose = 0.58
* Pregnancies & Age = 0.54
* BloodPressure & Age = 0.33
* BMI & BloodPressure = 0.29

## Plots
```{r ggPairs}
ggpairs(diab1)
```

### Outcome Barplot
```{r Bar}
ggplot(diab1,
       aes(Outcome)) +
  geom_bar()
```

### Histograms, grouped by Outcome
```{r Histogram}
# Grouped
# p <- data %>%
#   ggplot( aes(x=value, fill=type)) +
#     geom_histogram( color="#e9ecef", alpha=0.6, position = 'identity') +
#     scale_fill_manual(values=c("#69b3a2", "#404080")) +
#     theme_ipsum() +
#     labs(fill="")

Glucose_hist <- diab1 %>%
  ggplot(aes(x = Glucose,
             fill = Outcome)) +
  geom_histogram(binwidth = 5)
Glucose_hist

BP_hist <- diab1 %>%
  ggplot(aes(x = BloodPressure,
             fill = Outcome)) +
  geom_histogram(binwidth = 5)
BP_hist

BMI_hist <- diab1 %>%
  ggplot(aes(x = BMI,
             fill = Outcome)) +
  geom_histogram(binwidth = 2)
BMI_hist

Ped_hist <- diab1 %>%
  ggplot(aes(x = DiabetesPedigreeFunction,
             fill = Outcome)) +
  geom_histogram(binwidth = 0.075)
Ped_hist

Age_hist <- diab1 %>%
  ggplot(aes(x = Age,
             fill = Outcome)) +
  geom_histogram(binwidth = 2)
Age_hist
```

### Scatter Plots, grouped by Outcome
```{r Scatter Plots}
#Highest Correlating Variables:
# BMI & SkinThickness = 0.65
# Insulin & Glucose = 0.58
# Pregnancies & Age = 0.54
# BloodPressure & Age = 0.33
# BMI & BloodPressure = 0.29

# BMI & SkinThickness = 0.65
BMI_Skin <- ggplot(data = diab1,
                   aes(x = BMI,
                       y = SkinThickness,
                       color = Outcome),
                   na.rm = TRUE) +
  geom_point(size = 0.5) +
  geom_smooth(method = lm) +
  labs(title = "BMI vs. Skin Thickness")
BMI_Skin

# Insulin & Glucose = 0.58
Insu_Glucose <- ggplot(data = diab1,
                       aes(x = Insulin,
                           y = Glucose,
                           color = Outcome),
                       na.rm = TRUE) +
  geom_point(size = 0.5) +
  geom_smooth(method = lm) +
  labs(title = "Insulin vs. Glucose")
Insu_Glucose

# Pregnancies & Age = 0.54
Age_Preg <- ggplot(data = diab1,
                   aes(x = Age,
                       y = Pregnancies,
                       color = Outcome),
                   na.rm = TRUE) +
  geom_point(size = 0.5) +
  geom_smooth(method = lm) +
  labs(title = "Age vs. Pregnancies")
Age_Preg

# BloodPressure & Age = 0.33
Age_BP <- ggplot(data = diab1,
                    aes(x = Age,
                        y = BloodPressure,
                        color = Outcome),
                    na.rm = TRUE) +
  geom_point(size = 0.5) +
  geom_smooth(method = lm) +
  labs(title = "Age vs. Blood Pressure")
Age_BP

# Glucose & Age = 0.32
Age_Glucose <- ggplot(data = diab1,
                      aes(x = Age,
                          y = Glucose,
                          color = Outcome),
                      na.rm = TRUE) +
  geom_point(size = 0.5) +
  geom_smooth(method = lm) +
  labs(title = "Age vs. Glucose")
Age_Glucose

# BloodPressure & BMI = 0.29
BMI_BP <- ggplot(data = diab1,
                 aes(x = BMI,
                     y = BloodPressure,
                     color = Outcome),
                 na.rm = TRUE) +
  geom_point(size = 0.5) +
  geom_smooth(method = lm) +
  labs(title = "BMI vs. Blood Pressure")
BMI_BP
```

***

# Predictive Models
## Train & Test Split
```{r Sample Split}
set.seed(123)
split <- sample.split(diab1$Outcome,
                      SplitRatio = 0.8)
diab.train <- subset(diab1,
                     split == TRUE)
diab.test <- subset(subset(diab1,
                           split == FALSE))

nrow(diab.test)
nrow(diab.train)
```

```{r Train Head/Str}
head(diab.train)
str(diab.train)
```

```{r Rows & Columns}
nrow(diab.train)
ncol(diab.train)
```

```{r Train/Test NA Check}
sum(is.na(diab.train))
sum(is.na(diab.test))
```

```{r Train Mean Imputation}
diab.train$Glucose[is.na(diab.train$Glucose)] <- mean(diab.train$Glucose,
                                          na.rm = TRUE)
diab.train$BloodPressure[is.na(diab.train$BloodPressure)] <- mean(diab.train$BloodPressure,
                                                      na.rm = TRUE)
diab.train$SkinThickness[is.na(diab.train$SkinThickness)] <- mean(diab.train$SkinThickness,
                                                      na.rm = TRUE)
diab.train$Insulin[is.na(diab.train$Insulin)] <- mean(diab.train$Insulin,
                                          na.rm = TRUE)
diab.train$BMI[is.na(diab.train$BMI)] <- mean(diab.train$BMI,
                                  na.rm = TRUE)

sum(is.na(diab.train))

str(diab.train)
```

```{r Test Mean Imputation}
diab.test$Glucose[is.na(diab.test$Glucose)] <- mean(diab.train$Glucose,
                                          na.rm = TRUE)
diab.test$BloodPressure[is.na(diab.test$BloodPressure)] <- mean(diab.train$BloodPressure,
                                                      na.rm = TRUE)
diab.test$SkinThickness[is.na(diab.test$SkinThickness)] <- mean(diab.train$SkinThickness,
                                                      na.rm = TRUE)
diab.test$Insulin[is.na(diab.test$Insulin)] <- mean(diab.train$Insulin,
                                          na.rm = TRUE)
diab.test$BMI[is.na(diab.test$BMI)] <- mean(diab.train$BMI,
                                  na.rm = TRUE)

sum(is.na(diab.test))

head(diab.test)
```

